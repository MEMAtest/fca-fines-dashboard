<!DOCTYPE html>
<html lang="en-GB">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>FCA Fines Analysis Dashboard</title>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
Â  Â  <style>
Â  Â  Â  Â  * {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  }

Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
Â  Â  Â  Â  Â  Â  background-color: #f5f7fa;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  Â  Â  line-height: 1.6;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Header Styles */
Â  Â  Â  Â  .header {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #003e5a 0%, #007ea7 100%);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 2rem;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
Â  Â  Â  Â  }

Â  Â  Â  Â  .header h1 {
Â  Â  Â  Â  Â  Â  font-size: 2.5rem;
Â  Â  Â  Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  }

Â  Â  Â  Â  .header p {
Â  Â  Â  Â  Â  Â  font-size: 1.1rem;
Â  Â  Â  Â  Â  Â  opacity: 0.9;
Â  Â  Â  Â  }

Â  Â  Â  Â  .branding {
Â  Â  Â  Â  Â  Â  margin-top: 1rem;
Â  Â  Â  Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  Â  Â  Â  opacity: 0.8;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Logo Styles */
.header-logo {
Â  Â  Â  Â  text-align: center;
}

.logo {
Â  Â  height: 50px;
Â  Â  width: auto;
Â  Â  max-width: 200px;
Â  Â  /* Maintains original logo colours for professional appearance */
}

.logo {
Â  Â  height: 60px;
Â  Â  width: auto;
Â  Â  filter: brightness(0) invert(1); /* Makes logo white for dark header */
Â  Â  transition: transform 0.3s ease;
}

.logo:hover {
Â  Â  transform: scale(1.05);
}

/* Alternative: Keep original logo colours */
.logo-original {
Â  Â  height: 60px;
Â  Â  width: auto;
Â  Â  background: white;
Â  Â  padding: 0.5rem;
Â  Â  border-radius: 8px;
}

Â  Â  Â  Â  /* Container */
Â  Â  Â  Â  .container {
Â  Â  Â  Â  Â  Â  max-width: 1400px;
Â  Â  Â  Â  Â  Â  margin: 0 auto;
Â  Â  Â  Â  Â  Â  padding: 2rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Summary Cards */
Â  Â  Â  Â  .summary-cards {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
Â  Â  Â  Â  Â  Â  gap: 1.5rem;
Â  Â  Â  Â  Â  Â  margin-bottom: 2rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .card {
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  padding: 1.5rem;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 10px rgba(0,0,0,0.08);
Â  Â  Â  Â  Â  Â  transition: transform 0.2s, box-shadow 0.2s;
Â  Â  Â  Â  Â  Â  border-left: 4px solid #007ea7;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }

Â  Â  Â  Â  .card::before {
Â  Â  Â  Â  Â  Â  content: '';
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  right: 0;
Â  Â  Â  Â  Â  Â  height: 4px;
Â  Â  Â  Â  Â  Â  background: linear-gradient(90deg, #003e5a, #007ea7, #00a8e8);
Â  Â  Â  Â  Â  Â  animation: shimmer 3s ease-in-out infinite;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes shimmer {
Â  Â  Â  Â  Â  Â  0% { transform: translateX(-100%); }
Â  Â  Â  Â  Â  Â  100% { transform: translateX(100%); }
Â  Â  Â  Â  }

Â  Â  Â  Â  .card:hover {
Â  Â  Â  Â  Â  Â  transform: translateY(-2px);
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 20px rgba(0,0,0,0.12);
Â  Â  Â  Â  }

Â  Â  Â  Â  .card:nth-child(1) { border-left-color: #003e5a; }
Â  Â  Â  Â  .card:nth-child(2) { border-left-color: #007ea7; }
Â  Â  Â  Â  .card:nth-child(3) { border-left-color: #00a8e8; }
Â  Â  Â  Â  .card:nth-child(4) { border-left-color: #2ecc71; }

Â  Â  Â  Â  .card-label {
Â  Â  Â  Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  Â  Â  Â  color: #666;
Â  Â  Â  Â  Â  Â  text-transform: uppercase;
Â  Â  Â  Â  Â  Â  letter-spacing: 0.5px;
Â  Â  Â  Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .card-value {
Â  Â  Â  Â  Â  Â  font-size: 2rem;
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  color: #003e5a;
Â  Â  Â  Â  Â  Â  margin-bottom: 0.25rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .card-subtitle {
Â  Â  Â  Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  Â  Â  Â  color: #777;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Filters Section */
Â  Â  Â  Â  .filters-section {
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  padding: 2rem;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 10px rgba(0,0,0,0.08);
Â  Â  Â  Â  Â  Â  margin-bottom: 2rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .filters-header {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  margin-bottom: 1.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .filters-title {
Â  Â  Â  Â  Â  Â  font-size: 1.5rem;
Â  Â  Â  Â  Â  Â  color: #003e5a;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }

Â  Â  Â  Â  .filter-count {
Â  Â  Â  Â  Â  Â  background: #00a8e8;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 0.25rem 0.75rem;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .filters-grid {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
Â  Â  Â  Â  Â  Â  gap: 1.5rem;
Â  Â  Â  Â  Â  Â  margin-bottom: 1.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .filter-group label {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  color: #555;
Â  Â  Â  Â  }

Â  Â  Â  Â  .filter-group select,
Â  Â  Â  Â  .filter-group input {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: 0.75rem;
Â  Â  Â  Â  Â  Â  border: 2px solid #e0e6ed;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  font-size: 1rem;
Â  Â  Â  Â  Â  Â  transition: border-color 0.2s;
Â  Â  Â  Â  }

Â  Â  Â  Â  .filter-group select:focus,
Â  Â  Â  Â  .filter-group input:focus {
Â  Â  Â  Â  Â  Â  outline: none;
Â  Â  Â  Â  Â  Â  border-color: #007ea7;
Â  Â  Â  Â  }

Â  Â  Â  Â  .multi-select {
Â  Â  Â  Â  Â  Â  min-height: 120px;
Â  Â  Â  Â  Â  Â  padding: 0.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .multi-select option {
Â  Â  Â  Â  Â  Â  padding: 0.25rem 0.5rem;
Â  Â  Â  Â  Â  Â  margin: 2px 0;
Â  Â  Â  Â  }

Â  Â  Â  Â  .multi-select option:checked {
Â  Â  Â  Â  Â  Â  background: #007ea7;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }

Â  Â  Â  Â  .filter-actions {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: 1rem;
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn {
Â  Â  Â  Â  Â  Â  padding: 0.75rem 1.5rem;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  font-size: 1rem;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  Â  Â  display: inline-flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 0.5rem;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn::before {
Â  Â  Â  Â  Â  Â  content: '';
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  width: 0;
Â  Â  Â  Â  Â  Â  height: 0;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.2);
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  transition: width 0.5s, height 0.5s;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn:hover::before {
Â  Â  Â  Â  Â  Â  width: 300px;
Â  Â  Â  Â  Â  Â  height: 300px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-primary {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #007ea7 0%, #00a8e8 100%);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 4px rgba(0, 126, 167, 0.3);
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-primary:hover {
Â  Â  Â  Â  Â  Â  transform: translateY(-1px);
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 8px rgba(0, 126, 167, 0.4);
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-secondary {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-secondary:hover {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #5a6268 0%, #495057 100%);
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-success {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 4px rgba(46, 204, 113, 0.3);
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-success:hover {
Â  Â  Â  Â  Â  Â  transform: translateY(-1px);
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 8px rgba(46, 204, 113, 0.4);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Insights Section */
Â  Â  Â  Â  .insights-section {
Â  Â  Â  Â  Â  Â  background: #f8f9fa;
Â  Â  Â  Â  Â  Â  padding: 2rem;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  margin-bottom: 2rem;
Â  Â  Â  Â  Â  Â  border: 1px solid #e9ecef;
Â  Â  Â  Â  }

Â  Â  Â  Â  .insights-header {
Â  Â  Â  Â  Â  Â  font-size: 1.3rem;
Â  Â  Â  Â  Â  Â  color: #003e5a;
Â  Â  Â  Â  Â  Â  margin-bottom: 1.5rem;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }

Â  Â  Â  Â  .insights-grid {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
Â  Â  Â  Â  Â  Â  gap: 1.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .insight-card {
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  padding: 1.5rem;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  border-left: 4px solid #00a8e8;
Â  Â  Â  Â  }

Â  Â  Â  Â  .insight-title {
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  color: #003e5a;
Â  Â  Â  Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .insight-value {
Â  Â  Â  Â  Â  Â  color: #666;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Deeper Insights Section */
Â  Â  Â  Â  .deeper-insights-section {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
Â  Â  Â  Â  Â  Â  padding: 2.5rem;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  margin-bottom: 2rem;
Â  Â  Â  Â  Â  Â  border: 1px solid #dee2e6;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }

Â  Â  Â  Â  .deeper-insights-header {
Â  Â  Â  Â  Â  Â  font-size: 1.4rem;
Â  Â  Â  Â  Â  Â  color: #003e5a;
Â  Â  Â  Â  Â  Â  margin-bottom: 2rem;
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 0.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .deeper-insights-grid {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
Â  Â  Â  Â  Â  Â  gap: 2rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .deep-insight-card {
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  padding: 2rem;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 3px 15px rgba(0,0,0,0.1);
Â  Â  Â  Â  Â  Â  transition: all 0.3s;
Â  Â  Â  Â  }

Â  Â  Â  Â  .deep-insight-card:hover {
Â  Â  Â  Â  Â  Â  transform: translateY(-3px);
Â  Â  Â  Â  Â  Â  box-shadow: 0 5px 25px rgba(0,0,0,0.15);
Â  Â  Â  Â  }

Â  Â  Â  Â  .deep-insight-title {
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  color: #003e5a;
Â  Â  Â  Â  Â  Â  margin-bottom: 1rem;
Â  Â  Â  Â  Â  Â  font-size: 1.1rem;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 0.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .deep-insight-content {
Â  Â  Â  Â  Â  Â  color: #495057;
Â  Â  Â  Â  Â  Â  line-height: 1.6;
Â  Â  Â  Â  }

Â  Â  Â  Â  .metric-value {
Â  Â  Â  Â  Â  Â  font-size: 2rem;
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  color: #007ea7;
Â  Â  Â  Â  Â  Â  margin: 0.5rem 0;
Â  Â  Â  Â  }

Â  Â  Â  Â  .metric-comparison {
Â  Â  Â  Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  Â  Â  Â  color: #6c757d;
Â  Â  Â  Â  Â  Â  margin-top: 0.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .trend-indicator {
Â  Â  Â  Â  Â  Â  display: inline-flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 0.25rem;
Â  Â  Â  Â  Â  Â  padding: 0.25rem 0.5rem;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  margin-left: 0.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .trend-up {
Â  Â  Â  Â  Â  Â  background: #fce4ec;
Â  Â  Â  Â  Â  Â  color: #c2185b;
Â  Â  Â  Â  }

Â  Â  Â  Â  .trend-down {
Â  Â  Â  Â  Â  Â  background: #e8f5e9;
Â  Â  Â  Â  Â  Â  color: #388e3c;
Â  Â  Â  Â  }

Â  Â  Â  Â  .entity-list {
Â  Â  Â  Â  Â  Â  margin-top: 1rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .entity-item {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  padding: 0.75rem;
Â  Â  Â  Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  Â  Â  Â  Â  background: #f8f9fa;
Â  Â  Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  Â  Â  transition: background 0.2s;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }

Â  Â  Â  Â  .entity-item:hover {
Â  Â  Â  Â  Â  Â  background: #e9ecef;
Â  Â  Â  Â  Â  Â  transform: translateX(2px);
Â  Â  Â  Â  }

Â  Â  Â  Â  .entity-scrollable {
Â  Â  Â  Â  Â  Â  max-height: 300px;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  padding-right: 0.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .entity-scrollable::-webkit-scrollbar {
Â  Â  Â  Â  Â  Â  width: 6px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .entity-scrollable::-webkit-scrollbar-track {
Â  Â  Â  Â  Â  Â  background: #f1f1f1;
Â  Â  Â  Â  Â  Â  border-radius: 3px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .entity-scrollable::-webkit-scrollbar-thumb {
Â  Â  Â  Â  Â  Â  background: #007ea7;
Â  Â  Â  Â  Â  Â  border-radius: 3px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .entity-scrollable::-webkit-scrollbar-thumb:hover {
Â  Â  Â  Â  Â  Â  background: #006587;
Â  Â  Â  Â  }

Â  Â  Â  Â  .entity-name {
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  color: #003e5a;
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  }

Â  Â  Â  Â  .entity-count {
Â  Â  Â  Â  Â  Â  background: #007ea7;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 0.25rem 0.75rem;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }

Â  Â  Â  Â  .icon-trend { color: #f39c12; }
Â  Â  Â  Â  .icon-repeat { color: #e74c3c; }
Â  Â  Â  Â  .icon-stats { color: #3498db; }
Â  Â  Â  Â  .icon-crown { color: #9b59b6; }
Â  Â  Â  Â  .icon-pie { color: #2ecc71; }

Â  Â  Â  Â  /* Charts Grid */
Â  Â  Â  Â  .charts-grid {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
Â  Â  Â  Â  Â  Â  gap: 2rem;
Â  Â  Â  Â  Â  Â  margin-bottom: 2rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .chart-container {
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  padding: 2rem;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 10px rgba(0,0,0,0.08);
Â  Â  Â  Â  }

Â  Â  Â  Â  .chart-title {
Â  Â  Â  Â  Â  Â  font-size: 1.2rem;
Â  Â  Â  Â  Â  Â  color: #003e5a;
Â  Â  Â  Â  Â  Â  margin-bottom: 1.5rem;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }

Â  Â  Â  Â  .chart-wrapper {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  height: 300px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Data Table */
Â  Â  Â  Â  .table-section {
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  padding: 2rem;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 10px rgba(0,0,0,0.08);
Â  Â  Â  Â  }

Â  Â  Â  Â  .table-header {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  margin-bottom: 1.5rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .table-title {
Â  Â  Â  Â  Â  Â  font-size: 1.3rem;
Â  Â  Â  Â  Â  Â  color: #003e5a;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }

Â  Â  Â  Â  .table-wrapper {
Â  Â  Â  Â  Â  Â  overflow-x: auto;
Â  Â  Â  Â  }

Â  Â  Â  Â  table {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  border-collapse: collapse;
Â  Â  Â  Â  }

Â  Â  Â  Â  th {
Â  Â  Â  Â  Â  Â  background: #f8f9fa;
Â  Â  Â  Â  Â  Â  padding: 1rem;
Â  Â  Â  Â  Â  Â  text-align: left;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  color: #003e5a;
Â  Â  Â  Â  Â  Â  border-bottom: 2px solid #dee2e6;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  user-select: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  th:hover {
Â  Â  Â  Â  Â  Â  background: #e9ecef;
Â  Â  Â  Â  }

Â  Â  Â  Â  td {
Â  Â  Â  Â  Â  Â  padding: 1rem;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #dee2e6;
Â  Â  Â  Â  }

Â  Â  Â  Â  tr:hover {
Â  Â  Â  Â  Â  Â  background: #f8f9fa;
Â  Â  Â  Â  }

Â  Â  Â  Â  .badge {
Â  Â  Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  Â  Â  padding: 0.25rem 0.75rem;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  }

Â  Â  Â  Â  .badge:hover {
Â  Â  Â  Â  Â  Â  transform: translateY(-1px);
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 5px rgba(0,0,0,0.15);
Â  Â  Â  Â  }

Â  Â  Â  Â  .badge-category {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
Â  Â  Â  Â  Â  Â  color: #1565c0;
Â  Â  Â  Â  }

Â  Â  Â  Â  .badge-breach {
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%);
Â  Â  Â  Â  Â  Â  color: #c2185b;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Pagination */
Â  Â  Â  Â  .pagination {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 0.5rem;
Â  Â  Â  Â  Â  Â  margin-top: 2rem;
Â  Â  Â  Â  }

Â  Â  Â  Â  .pagination button {
Â  Â  Â  Â  Â  Â  padding: 0.5rem 1rem;
Â  Â  Â  Â  Â  Â  border: 1px solid #dee2e6;
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  }

Â  Â  Â  Â  .pagination button:hover:not(:disabled) {
Â  Â  Â  Â  Â  Â  background: #007ea7;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border-color: #007ea7;
Â  Â  Â  Â  }

Â  Â  Â  Â  .pagination button:disabled {
Â  Â  Â  Â  Â  Â  opacity: 0.5;
Â  Â  Â  Â  Â  Â  cursor: not-allowed;
Â  Â  Â  Â  }

Â  Â  Â  Â  .pagination .page-info {
Â  Â  Â  Â  Â  Â  margin: 0 1rem;
Â  Â  Â  Â  Â  Â  color: #666;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Responsive */
Â  Â  Â  Â  @media (max-width: 768px) {
Â  Â  Â  Â  Â  Â  .header h1 {
Â  Â  Â  Â  Â  Â  Â  Â  font-size: 1.8rem;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .charts-grid {
Â  Â  Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .filters-grid {
Â  Â  Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .filter-actions {
Â  Â  Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .btn {
Â  Â  Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Print Styles */
Â  Â  Â  Â  @media print {
Â  Â  Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .filters-section,
Â  Â  Â  Â  Â  Â  .pagination {
Â  Â  Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  .card,
Â  Â  Â  Â  Â  Â  .chart-container,
Â  Â  Â  Â  Â  Â  .table-section {
Â  Â  Â  Â  Â  Â  Â  Â  box-shadow: none;
Â  Â  Â  Â  Â  Â  Â  Â  border: 1px solid #dee2e6;
Â  Â  Â  Â  Â  Â  Â  Â  break-inside: avoid;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â /* Loading Spinner */
.loading {
Â  Â  display: none;
Â  Â  position: fixed;
Â  Â  top: 50%;
Â  Â  left: 50%;
Â  Â  transform: translate(-50%, -50%);
Â  Â  background: white;
Â  Â  padding: 2rem;
Â  Â  border-radius: 12px;
Â  Â  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
Â  Â  text-align: center;
Â  Â  z-index: 1000;
}

.loading::before {
Â  Â  content: '';
Â  Â  display: inline-block;
Â  Â  width: 40px;
Â  Â  height: 40px;
Â  Â  border: 4px solid #f3f3f3;
Â  Â  border-top: 4px solid #007ea7;
Â  Â  border-radius: 50%;
Â  Â  animation: spin 1s linear infinite;
Â  Â  margin-bottom: 1rem;
}

@keyframes spin {
Â  Â  0% { transform: rotate(0deg); }
Â  Â  100% { transform: rotate(360deg); }
}

.loading-overlay {
Â  Â  display: none;
Â  Â  position: fixed;
Â  Â  top: 0;
Â  Â  left: 0;
Â  Â  width: 100%;
Â  Â  height: 100%;
Â  Â  background: rgba(0,0,0,0.3);
Â  Â  z-index: 999;
}Â Â 

Â  Â  </style>
</head>
<body>
Â  Â  Â  Â  <header class="header">
Â  Â  <div class="header-logo">
Â  Â  Â  Â  <img src="mema-logo.png" alt="MEMA Consultants" class="logo">
Â  Â  </div>
Â  Â  <h1>FCA Fines Analysis Dashboard</h1>
Â  Â  <p>Analysis of regulatory enforcement actions from 2013-2024</p>
Â  Â  <div class="branding">www.memaconsultants.com</div>
</header>

Â  Â  Â  Â  <div class="container">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="summary-cards">
Â  Â  Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-label">TOTAL FINE AMOUNT</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-value" id="totalAmount">Â£0</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-subtitle">Across all enforcement actions</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-label">NUMBER OF FINES</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-value" id="totalCount">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-subtitle">Total enforcement actions</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-label">AVERAGE FINE</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-value" id="averageFine">Â£0</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-subtitle">Mean fine amount</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-label">LARGEST FINE</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-value" id="largestFine">Â£0</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-subtitle" id="largestFineEntity">-</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="filters-section">
Â  Â  Â  Â  Â  Â  <div class="filters-header">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="filters-title">ğŸ” Filter Data</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="filter-count" id="activeFilters">0 active filters</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="filters-grid">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="filter-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="yearFilter">Year</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="yearFilter" multiple class="multi-select">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">All Years</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="filter-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="categoryFilter">Firm Category</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="categoryFilter">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">All Categories</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="filter-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="breachFilter">Breach Type</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="breachFilter">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">All Breach Types</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="filter-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="searchFilter">Search</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="searchFilter" placeholder="Search firms or summaries...">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="filter-actions">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" onclick="applyFilters()">ğŸ” Apply Filters</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" onclick="resetFilters()">ğŸ”„ Reset Filters</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-success" onclick="exportData()">ğŸ“Š Export Data (CSV)</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="insights-section">
Â  Â  Â  Â  Â  Â  <h2 class="insights-header">ğŸ’¡ Key Insights</h2>
Â  Â  Â  Â  Â  Â  <div class="insights-grid" id="insightsGrid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="deeper-insights-section">
Â  Â  Â  Â  Â  Â  <h2 class="deeper-insights-header">ğŸ” Deeper Analysis</h2>
Â  Â  Â  Â  Â  Â  <div class="deeper-insights-grid" id="deeperInsightsGrid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="charts-grid">
Â  Â  Â  Â  Â  Â  <div class="chart-container">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="chart-title">Year-over-Year Trends</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="chart-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="trendsChart"></canvas>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="chart-container">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="chart-title">Top Firm Categories</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="chart-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="categoriesChart"></canvas>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="chart-container">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="chart-title">Fine Amount Distribution</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="chart-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="distributionChart"></canvas>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="chart-container">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="chart-title">Top 10 Breach Types</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="chart-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="breachTypesChart"></canvas>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="table-section">
Â  Â  Â  Â  Â  Â  <div class="table-header">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="table-title">ğŸ“‹ Fine Details</h2>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="table-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  <table id="dataTable">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th onclick="sortTable('date')">Date â†•</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th onclick="sortTable('firm')">Firm/Individual â†•</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th onclick="sortTable('amount')">Amount â†•</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th onclick="sortTable('category')">Category â†•</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th onclick="sortTable('breach')">Breach Type â†•</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="tableBody">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="pagination" id="pagination">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

<div class="loading-overlay" id="loadingOverlay"></div>
<div class="loading" id="loading">
Â  Â  <div>Loading FCA Fines Data...</div>
</div>

Â  Â  <script>
Â  Â  Â  Â  Â // Supabase configuration
const SUPABASE_URL = 'https://jypcwaskqihgnnasawie.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp5cGN3YXNrcWloZ25uYXNhd2llIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg4OTkxOTcsImV4cCI6MjA2NDQ3NTE5N30.wl3g5eOASYSw52IA2jnQo7DMDtiT8BW9waj-kZJpVDE';

// Initialize Supabase client
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);;

Â  Â  Â  Â  // Global variables
Â  Â  Â  Â  let allData = [];
Â  Â  Â  Â  let filteredData = [];
Â  Â  Â  Â  let charts = {};
Â  Â  Â  Â  let currentPage = 1;
Â  Â  Â  Â  const rowsPerPage = 10;
Â  Â  Â  Â  let sortField = 'date';
Â  Â  Â  Â  let sortDirection = 'desc';

Â  Â  Â  Â  // Column mapping configuration
Â  Â  Â  Â  const COLUMN_MAPPINGS = {
Â  Â  Â  Â  Â  Â  date: ['Date_MM/YYYY', 'Date (MM/YYYY)', 'Date', 'Fine Date'],
Â  Â  Â  Â  Â  Â  firm: ['Firm/Individual', 'Entity', 'Company/Person', 'Name'],
Â  Â  Â  Â  Â  Â  amount: ['Amount', 'Amount (Â£)', 'Fine Amount', 'Penalty'],
Â  Â  Â  Â  Â  Â  summary: ['Summary', 'Description', 'Violation', 'Details'],
Â  Â  Â  Â  Â  Â  regulator: ['Regulator', 'Regulatory Body', 'Authority'],
Â  Â  Â  Â  Â  Â  category: ['Firm Category', 'Category', 'Type', 'Firm Type'],
Â  Â  Â  Â  Â  Â  breach: ['Breach Type', 'Violation Type', 'Breach Category']
Â  Â  Â  Â  };

Â  Â  Â  Â  // Initialize dashboard on load
document.addEventListener('DOMContentLoaded', function() {
Â  Â  loadDataFromSupabase();
});

// Load data from Supabase
async function loadDataFromSupabase() {
Â  Â  try {
Â  Â  Â  Â  showLoading(true);
Â  Â  Â  Â Â 
Â  Â  Â  Â  const { data, error } = await supabase
Â  Â  Â  Â  Â  Â  .from('fca_fines')
Â  Â  Â  Â  Â  Â  .select('*')
Â  Â  Â  Â  Â  Â  .order('date_issued', { ascending: false });
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (error) throw error;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Transform data to match existing format
Â  Â  Â  Â  allData = data.map(record => ({
Â  Â  Â  Â  Â  Â  date: new Date(record.date_issued),
Â  Â  Â  Â  Â  Â  year: record.year_issued,
Â  Â  Â  Â  Â  Â  month: record.month_issued,
Â  Â  Â  Â  Â  Â  firm: record.firm_individual,
Â  Â  Â  Â  Â  Â  amount: parseFloat(record.amount),
Â  Â  Â  Â  Â  Â  summary: record.summary,
Â  Â  Â  Â  Â  Â  regulator: record.regulator,
Â  Â  Â  Â  Â  Â  firmCategory: record.firm_category,
Â  Â  Â  Â  Â  Â  breachType: record.breach_type
Â  Â  Â  Â  }));
Â  Â  Â  Â Â 
Â  Â  Â  Â  filteredData = [...allData];
Â  Â  Â  Â  initializeFilters();
Â  Â  Â  Â  applyFilters();
Â  Â  Â  Â Â 
Â  Â  } catch (error) {
Â  Â  Â  Â  console.error('Error loading data:', error);
Â  Â  Â  Â  showError('Failed to load FCA fines data. Please refresh the page.');
Â  Â  } finally {
Â  Â  Â  Â  showLoading(false);
Â  Â  }
}

// Show/hide loading state
function showLoading(show) {
Â  Â  const loading = document.getElementById('loading');
Â  Â  const overlay = document.getElementById('loadingOverlay');
Â  Â  if (loading && overlay) {
Â  Â  Â  Â  loading.style.display = show ? 'block' : 'none';
Â  Â  Â  Â  overlay.style.display = show ? 'block' : 'none';
Â  Â  }
}

// Show error message
function showError(message) {
Â  Â  const container = document.querySelector('.container');
Â  Â  const errorDiv = document.createElement('div');
Â  Â  errorDiv.style.cssText = `
Â  Â  Â  Â  background: #fee;
Â  Â  Â  Â  border: 1px solid #fcc;
Â  Â  Â  Â  color: #c00;
Â  Â  Â  Â  padding: 1rem;
Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  margin: 1rem 0;
Â  Â  Â  Â  text-align: center;
Â  Â  `;
Â  Â  errorDiv.textContent = message;
Â  Â  container.insertBefore(errorDiv, container.firstChild);
}
Â  Â  Â  Â  // Initialize filters
Â  Â  Â  Â  function initializeFilters() {
Â  Â  Â  Â  Â  Â  // Populate year filter
Â  Â  Â  Â  Â  Â  const years = [...new Set(allData.map(d => d.year))].sort((a, b) => b - a);
Â  Â  Â  Â  Â  Â  const yearFilter = document.getElementById('yearFilter');
Â  Â  Â  Â  Â  Â  years.forEach(year => {
Â  Â  Â  Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  Â  Â  Â  option.value = year;
Â  Â  Â  Â  Â  Â  Â  Â  option.textContent = year;
Â  Â  Â  Â  Â  Â  Â  Â  yearFilter.appendChild(option);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Populate category filter
Â  Â  Â  Â  Â  Â  const categories = [...new Set(allData.map(d => d.firmCategory))].sort();
Â  Â  Â  Â  Â  Â  const categoryFilter = document.getElementById('categoryFilter');
Â  Â  Â  Â  Â  Â  categories.forEach(category => {
Â  Â  Â  Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  Â  Â  Â  option.value = category;
Â  Â  Â  Â  Â  Â  Â  Â  option.textContent = category;
Â  Â  Â  Â  Â  Â  Â  Â  categoryFilter.appendChild(option);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Populate breach type filter
Â  Â  Â  Â  Â  Â  const breachTypes = [...new Set(allData.map(d => d.breachType))].sort();
Â  Â  Â  Â  Â  Â  const breachFilter = document.getElementById('breachFilter');
Â  Â  Â  Â  Â  Â  breachTypes.forEach(breach => {
Â  Â  Â  Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  Â  Â  Â  option.value = breach;
Â  Â  Â  Â  Â  Â  Â  Â  option.textContent = breach;
Â  Â  Â  Â  Â  Â  Â  Â  breachFilter.appendChild(option);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Add event listener for search input
Â  Â  Â  Â  Â  Â  document.getElementById('searchFilter').addEventListener('input', debounce(applyFilters, 300));
Â  Â  Â  Â  }

Â  Â  Â  Â  // Apply filters
Â  Â  Â  Â  function applyFilters() {
Â  Â  Â  Â  Â  Â  const yearFilter = document.getElementById('yearFilter');
Â  Â  Â  Â  Â  Â  const selectedYears = Array.from(yearFilter.selectedOptions)
Â  Â  Â  Â  Â  Â  Â  Â  .map(option => option.value)
Â  Â  Â  Â  Â  Â  Â  Â  .filter(value => value !== '');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const categoryFilter = document.getElementById('categoryFilter').value;
Â  Â  Â  Â  Â  Â  const breachFilter = document.getElementById('breachFilter').value;
Â  Â  Â  Â  Â  Â  const searchFilter = document.getElementById('searchFilter').value.toLowerCase();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  filteredData = allData.filter(row => {
Â  Â  Â  Â  Â  Â  Â  Â  // Year filter (multi-select)
Â  Â  Â  Â  Â  Â  Â  Â  if (selectedYears.length > 0 && !selectedYears.includes(row.year.toString())) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Category filter
Â  Â  Â  Â  Â  Â  Â  Â  if (categoryFilter && row.firmCategory !== categoryFilter) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Breach type filter
Â  Â  Â  Â  Â  Â  Â  Â  if (breachFilter && row.breachType !== breachFilter) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Search filter
Â  Â  Â  Â  Â  Â  Â  Â  if (searchFilter &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  !row.firm.toLowerCase().includes(searchFilter) &&Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  !row.summary.toLowerCase().includes(searchFilter)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Update active filter count
Â  Â  Â  Â  Â  Â  let activeFilters = 0;
Â  Â  Â  Â  Â  Â  if (selectedYears.length > 0) activeFilters++;
Â  Â  Â  Â  Â  Â  if (categoryFilter) activeFilters++;
Â  Â  Â  Â  Â  Â  if (breachFilter) activeFilters++;
Â  Â  Â  Â  Â  Â  if (searchFilter) activeFilters++;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('activeFilters').textContent = `${activeFilters} active filter${activeFilters !== 1 ? 's' : ''}`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  currentPage = 1;
Â  Â  Â  Â  Â  Â  updateDashboard();
Â  Â  Â  Â  }

Â  Â  Â  Â  // Reset filters
Â  Â  Â  Â  function resetFilters() {
Â  Â  Â  Â  Â  Â  document.getElementById('yearFilter').selectedIndex = -1;
Â  Â  Â  Â  Â  Â  document.getElementById('categoryFilter').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('breachFilter').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('searchFilter').value = '';
Â  Â  Â  Â  Â  Â  applyFilters();
Â  Â  Â  Â  }

Â  Â  Â  Â  // Update dashboard
Â  Â  Â  Â  function updateDashboard() {
Â  Â  Â  Â  Â  Â  updateSummaryCards();
Â  Â  Â  Â  Â  Â  updateInsights();
Â  Â  Â  Â  Â  Â  updateDeeperInsights();
Â  Â  Â  Â  Â  Â  updateCharts();
Â  Â  Â  Â  Â  Â  updateTable();
Â  Â  Â  Â  }

Â  Â  Â  Â  // Update summary cards
Â  Â  Â  Â  function updateSummaryCards() {
Â  Â  Â  Â  Â  Â  const totalAmount = filteredData.reduce((sum, d) => sum + d.amount, 0);
Â  Â  Â  Â  Â  Â  const totalCount = filteredData.length;
Â  Â  Â  Â  Â  Â  const averageAmount = totalCount > 0 ? totalAmount / totalCount : 0;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let largestFine = { amount: 0, firm: '' };
Â  Â  Â  Â  Â  Â  filteredData.forEach(d => {
Â  Â  Â  Â  Â  Â  Â  Â  if (d.amount > largestFine.amount) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  largestFine = { amount: d.amount, firm: d.firm };
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('totalAmount').textContent = formatAmount(totalAmount);
Â  Â  Â  Â  Â  Â  document.getElementById('totalCount').textContent = totalCount.toLocaleString();
Â  Â  Â  Â  Â  Â  document.getElementById('averageFine').textContent = formatAmount(averageAmount);
Â  Â  Â  Â  Â  Â  document.getElementById('largestFine').textContent = formatAmount(largestFine.amount);
Â  Â  Â  Â  Â  Â  document.getElementById('largestFineEntity').textContent = largestFine.firm || '-';
Â  Â  Â  Â  }

Â  Â  Â  Â  // Update insights
Â  Â  Â  Â  function updateInsights() {
Â  Â  Â  Â  Â  Â  const insightsGrid = document.getElementById('insightsGrid');
Â  Â  Â  Â  Â  Â  insightsGrid.innerHTML = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Top category by fine amount
Â  Â  Â  Â  Â  Â  const categoryTotals = {};
Â  Â  Â  Â  Â  Â  filteredData.forEach(d => {
Â  Â  Â  Â  Â  Â  Â  Â  categoryTotals[d.firmCategory] = (categoryTotals[d.firmCategory] || 0) + d.amount;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  const topCategory = Object.entries(categoryTotals)
Â  Â  Â  Â  Â  Â  Â  Â  .sort((a, b) => b[1] - a[1])[0];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Most common breach type
Â  Â  Â  Â  Â  Â  const breachCounts = {};
Â  Â  Â  Â  Â  Â  filteredData.forEach(d => {
Â  Â  Â  Â  Â  Â  Â  Â  breachCounts[d.breachType] = (breachCounts[d.breachType] || 0) + 1;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  const topBreach = Object.entries(breachCounts)
Â  Â  Â  Â  Â  Â  Â  Â  .sort((a, b) => b[1] - a[1])[0];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Large penalties
Â  Â  Â  Â  Â  Â  const largePenalties = filteredData.filter(d => d.amount > 10000000).length;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Calculate additional insight - Individuals vs Firms
Â  Â  Â  Â  Â  Â  const individualFines = filteredData.filter(d => d.firmCategory === 'Individual').length;
Â  Â  Â  Â  Â  Â  const totalFines = filteredData.length;
Â  Â  Â  Â  Â  Â  const individualPercentage = totalFines > 0 ? ((individualFines / totalFines) * 100).toFixed(1) : 0;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Create insight cards
Â  Â  Â  Â  Â  Â  if (topCategory) {
Â  Â  Â  Â  Â  Â  Â  Â  insightsGrid.innerHTML += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="insight-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="insight-title">Top Category</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="insight-value">${topCategory[0]} accounts for ${formatAmount(topCategory[1])} in fines</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (topBreach) {
Â  Â  Â  Â  Â  Â  Â  Â  insightsGrid.innerHTML += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="insight-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="insight-title">Most Common Breach</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="insight-value">${topBreach[0]} with ${topBreach[1]} occurrences</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  insightsGrid.innerHTML += `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="insight-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="insight-title">Large Penalties</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="insight-value">${largePenalties} fines exceeding Â£10 million</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  insightsGrid.innerHTML += `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="insight-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="insight-title">Individual vs Corporate</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="insight-value">${individualPercentage}% of fines are against individuals (${individualFines} of ${totalFines})</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Update deeper insights
Â  Â  Â  Â  function updateDeeperInsights() {
Â  Â  Â  Â  Â  Â  const deeperInsightsGrid = document.getElementById('deeperInsightsGrid');
Â  Â  Â  Â  Â  Â  deeperInsightsGrid.innerHTML = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 1. Most Frequently Fined Entities (with click-through)
Â  Â  Â  Â  Â  Â  const entityCounts = {};
Â  Â  Â  Â  Â  Â  const entityTotals = {};
Â  Â  Â  Â  Â  Â  filteredData.forEach(d => {
Â  Â  Â  Â  Â  Â  Â  Â  entityCounts[d.firm] = (entityCounts[d.firm] || 0) + 1;
Â  Â  Â  Â  Â  Â  Â  Â  entityTotals[d.firm] = (entityTotals[d.firm] || 0) + d.amount;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const topEntities = Object.entries(entityCounts)
Â  Â  Â  Â  Â  Â  Â  Â  .filter(([_, count]) => count > 1)
Â  Â  Â  Â  Â  Â  Â  Â  .sort((a, b) => b[1] - a[1])
Â  Â  Â  Â  Â  Â  Â  Â  .slice(0, 10);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const repeatOffendersHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="deep-insight-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="deep-insight-title">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="icon-repeat">ğŸ”</span> Most Frequently Fined Entities
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="deep-insight-content">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${topEntities.length > 0 ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="entity-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${topEntities.map(([firm, count]) => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="entity-item" onclick="filterByEntity('${firm.replace(/'/g, "\\'")}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="entity-name">${firm}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align: right;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="entity-count">${count} fines</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 0.85rem; color: #6c757d; margin-top: 0.25rem;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Total: ${formatAmount(entityTotals[firm])}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="margin-top: 1rem; font-size: 0.85rem; color: #6c757d; text-align: center;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Click on any entity to filter by that firm
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : '<p>No entities with multiple fines in current filter</p>'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 2. Median vs Average Analysis
Â  Â  Â  Â  Â  Â  const amounts = filteredData.map(d => d.amount).sort((a, b) => a - b);
Â  Â  Â  Â  Â  Â  const median = amounts.length > 0 ?Â 
Â  Â  Â  Â  Â  Â  Â  Â  (amounts.length % 2 === 0 ?Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (amounts[amounts.length / 2 - 1] + amounts[amounts.length / 2]) / 2 :Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  amounts[Math.floor(amounts.length / 2)]) : 0;
Â  Â  Â  Â  Â  Â  const average = amounts.length > 0 ?Â 
Â  Â  Â  Â  Â  Â  Â  Â  amounts.reduce((sum, a) => sum + a, 0) / amounts.length : 0;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const medianVsAvgHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="deep-insight-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="deep-insight-title">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="icon-stats">ğŸ“Š</span> Median vs Average Analysis
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="deep-insight-content">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display: flex; justify-content: space-around; margin-bottom: 1rem;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align: center;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 0.9rem; color: #6c757d;">Median Fine</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="metric-value" style="color: #00a8e8; font-size: 1.5rem;">${formatAmount(median)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align: center;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 0.9rem; color: #6c757d;">Average Fine</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="metric-value" style="color: #007ea7; font-size: 1.5rem;">${formatAmount(average)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="metric-comparison">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${median < average ?Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'The median is significantly lower than the average, indicating that large fines are skewing the average upward.' :
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'The median and average are relatively close, suggesting a more even distribution of fine amounts.'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 3. Largest Fine per Year (with scroll)
Â  Â  Â  Â  Â  Â  const largestPerYear = {};
Â  Â  Â  Â  Â  Â  filteredData.forEach(d => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!largestPerYear[d.year] || d.amount > largestPerYear[d.year].amount) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  largestPerYear[d.year] = { amount: d.amount, firm: d.firm };
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const sortedYears = Object.keys(largestPerYear).sort((a, b) => b - a);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const largestPerYearHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="deep-insight-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="deep-insight-title">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="icon-crown">ğŸ‘‘</span> Largest Fine per Year
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="deep-insight-content">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="entity-list entity-scrollable">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${sortedYears.map(year => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="entity-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>${year}</strong><br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-size: 0.9rem; color: #6c757d;">${largestPerYear[year].firm}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="entity-count" style="background: #e74c3c;">${formatAmount(largestPerYear[year].amount)}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 4. Distribution by Firm Category
Â  Â  Â  Â  Â  Â  const categoryBreakdown = {};
Â  Â  Â  Â  Â  Â  let totalAmount = 0;
Â  Â  Â  Â  Â  Â  filteredData.forEach(d => {
Â  Â  Â  Â  Â  Â  Â  Â  categoryBreakdown[d.firmCategory] = (categoryBreakdown[d.firmCategory] || { count: 0, amount: 0 });
Â  Â  Â  Â  Â  Â  Â  Â  categoryBreakdown[d.firmCategory].count++;
Â  Â  Â  Â  Â  Â  Â  Â  categoryBreakdown[d.firmCategory].amount += d.amount;
Â  Â  Â  Â  Â  Â  Â  Â  totalAmount += d.amount;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const sortedCategories = Object.entries(categoryBreakdown)
Â  Â  Â  Â  Â  Â  Â  Â  .sort((a, b) => b[1].amount - a[1].amount);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const categoryDistributionHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="deep-insight-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="deep-insight-title">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="icon-pie">ğŸ¥§</span> Distribution by Firm Category
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="deep-insight-content">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="entity-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${sortedCategories.map(([category, data]) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const percentage = totalAmount > 0 ? ((data.amount / totalAmount) * 100).toFixed(1) : 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="entity-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>${category}</strong><br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-size: 0.85rem; color: #6c757d;">${data.count} fines</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align: right;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-weight: 600; color: #007ea7;">${percentage}%</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 0.85rem; color: #6c757d;">${formatAmount(data.amount)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Add all insights to the grid
Â  Â  Â  Â  Â  Â  deeperInsightsGrid.innerHTML = repeatOffendersHTML + medianVsAvgHTML + largestPerYearHTML + categoryDistributionHTML;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Filter by entity function
Â  Â  Â  Â  function filterByEntity(entityName) {
Â  Â  Â  Â  Â  Â  document.getElementById('searchFilter').value = entityName;
Â  Â  Â  Â  Â  Â  applyFilters();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Scroll to top of page
Â  Â  Â  Â  Â  Â  window.scrollTo({ top: 0, behavior: 'smooth' });
Â  Â  Â  Â  }
Â  Â  Â  Â  function updateCharts() {
Â  Â  Â  Â  Â  Â  updateTrendsChart();
Â  Â  Â  Â  Â  Â  updateCategoriesChart();
Â  Â  Â  Â  Â  Â  updateDistributionChart();
Â  Â  Â  Â  Â  Â  updateBreachTypesChart();
Â  Â  Â  Â  }

Â  Â  Â  Â  // Update year-over-year trends chart
Â  Â  Â  Â  function updateTrendsChart() {
Â  Â  Â  Â  Â  Â  const yearData = {};
Â  Â  Â  Â  Â  Â  filteredData.forEach(d => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!yearData[d.year]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  yearData[d.year] = { amount: 0, count: 0 };
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  yearData[d.year].amount += d.amount;
Â  Â  Â  Â  Â  Â  Â  Â  yearData[d.year].count += 1;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const years = Object.keys(yearData).sort();
Â  Â  Â  Â  Â  Â  const amounts = years.map(y => yearData[y].amount);
Â  Â  Â  Â  Â  Â  const counts = years.map(y => yearData[y].count);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const ctx = document.getElementById('trendsChart').getContext('2d');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (charts.trends) {
Â  Â  Â  Â  Â  Â  Â  Â  charts.trends.destroy();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  charts.trends = new Chart(ctx, {
Â  Â  Â  Â  Â  Â  Â  Â  type: 'bar',
Â  Â  Â  Â  Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: years,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label: 'Total Fine Amount (Â£)',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: amounts,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: '#007ea7',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  yAxisID: 'y-amount',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  order: 2
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label: 'Number of Fines',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: counts,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'line',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: '#e74c3c',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: 'transparent',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  yAxisID: 'y-count',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  order: 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tension: 0.3
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }]
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responsive: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maintainAspectRatio: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  plugins: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tooltip: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  callbacks: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label: function(context) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (context.dataset.label.includes('Amount')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return context.dataset.label + ': ' + formatAmount(context.parsed.y);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return context.dataset.label + ': ' + context.parsed.y;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scales: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'y-amount': {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'linear',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  position: 'left',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ticks: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  callback: function(value) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return formatAmount(value);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'y-count': {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'linear',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  position: 'right',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  grid: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  drawOnChartArea: false
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // Update categories chart
Â  Â  Â  Â  function updateCategoriesChart() {
Â  Â  Â  Â  Â  Â  const categoryTotals = {};
Â  Â  Â  Â  Â  Â  filteredData.forEach(d => {
Â  Â  Â  Â  Â  Â  Â  Â  categoryTotals[d.firmCategory] = (categoryTotals[d.firmCategory] || 0) + d.amount;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const sortedCategories = Object.entries(categoryTotals)
Â  Â  Â  Â  Â  Â  Â  Â  .sort((a, b) => b[1] - a[1])
Â  Â  Â  Â  Â  Â  Â  Â  .slice(0, 7);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const otherTotal = Object.entries(categoryTotals)
Â  Â  Â  Â  Â  Â  Â  Â  .slice(7)
Â  Â  Â  Â  Â  Â  Â  Â  .reduce((sum, [_, amount]) => sum + amount, 0);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (otherTotal > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  sortedCategories.push(['Others', otherTotal]);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const ctx = document.getElementById('categoriesChart').getContext('2d');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (charts.categories) {
Â  Â  Â  Â  Â  Â  Â  Â  charts.categories.destroy();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  charts.categories = new Chart(ctx, {
Â  Â  Â  Â  Â  Â  Â  Â  type: 'pie',
Â  Â  Â  Â  Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: sortedCategories.map(c => c[0]),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: sortedCategories.map(c => c[1]),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '#003e5a', '#007ea7', '#00a8e8', '#2ecc71',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '#f39c12', '#e74c3c', '#9b59b6', '#95a5a6'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }]
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responsive: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maintainAspectRatio: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  plugins: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tooltip: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  callbacks: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label: function(context) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const total = context.dataset.data.reduce((sum, val) => sum + val, 0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const percentage = ((context.parsed / total) * 100).toFixed(1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return context.label + ': ' + formatAmount(context.parsed) + ' (' + percentage + '%)';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // Update distribution chart
Â  Â  Â  Â  function updateDistributionChart() {
Â  Â  Â  Â  Â  Â  const ranges = {
Â  Â  Â  Â  Â  Â  Â  Â  'Under Â£1M': 0,
Â  Â  Â  Â  Â  Â  Â  Â  'Â£1M-Â£10M': 0,
Â  Â  Â  Â  Â  Â  Â  Â  'Â£10M-Â£100M': 0,
Â  Â  Â  Â  Â  Â  Â  Â  'Over Â£100M': 0
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  filteredData.forEach(d => {
Â  Â  Â  Â  Â  Â  Â  Â  if (d.amount < 1000000) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ranges['Under Â£1M']++;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (d.amount < 10000000) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ranges['Â£1M-Â£10M']++;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (d.amount < 100000000) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ranges['Â£10M-Â£100M']++;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ranges['Over Â£100M']++;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const ctx = document.getElementById('distributionChart').getContext('2d');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (charts.distribution) {
Â  Â  Â  Â  Â  Â  Â  Â  charts.distribution.destroy();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  charts.distribution = new Chart(ctx, {
Â  Â  Â  Â  Â  Â  Â  Â  type: 'doughnut',
Â  Â  Â  Â  Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: Object.keys(ranges),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: Object.values(ranges),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: ['#3498db', '#2ecc71', '#f39c12', '#e74c3c']
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }]
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responsive: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maintainAspectRatio: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  plugins: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tooltip: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  callbacks: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label: function(context) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return context.label + ': ' + context.parsed + ' fines';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // Update breach types chart
Â  Â  Â  Â  function updateBreachTypesChart() {
Â  Â  Â  Â  Â  Â  const breachTotals = {};
Â  Â  Â  Â  Â  Â  filteredData.forEach(d => {
Â  Â  Â  Â  Â  Â  Â  Â  breachTotals[d.breachType] = (breachTotals[d.breachType] || 0) + d.amount;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const topBreaches = Object.entries(breachTotals)
Â  Â  Â  Â  Â  Â  Â  Â  .sort((a, b) => b[1] - a[1])
Â  Â  Â  Â  Â  Â  Â  Â  .slice(0, 10);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const ctx = document.getElementById('breachTypesChart').getContext('2d');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (charts.breaches) {
Â  Â  Â  Â  Â  Â  Â  Â  charts.breaches.destroy();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  charts.breaches = new Chart(ctx, {
Â  Â  Â  Â  Â  Â  Â  Â  type: 'bar',
Â  Â  Â  Â  Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: topBreaches.map(b => truncateLabel(b[0], 30)),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: topBreaches.map(b => b[1]),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: topBreaches.map(b => getBreachTypeColor(b[0]))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }]
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  indexAxis: 'y',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responsive: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maintainAspectRatio: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  plugins: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  legend: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  display: false
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tooltip: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  callbacks: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label: function(context) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return formatAmount(context.parsed.x);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // Update table
Â  Â  Â  Â  function updateTable() {
Â  Â  Â  Â  Â  Â  const tbody = document.getElementById('tableBody');
Â  Â  Â  Â  Â  Â  tbody.innerHTML = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Sort data
Â  Â  Â  Â  Â  Â  const sortedData = [...filteredData].sort((a, b) => {
Â  Â  Â  Â  Â  Â  Â  Â  let aVal, bVal;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  switch (sortField) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'date':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aVal = a.date;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bVal = b.date;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'firm':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aVal = a.firm.toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bVal = b.firm.toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'amount':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aVal = a.amount;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bVal = b.amount;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'category':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aVal = a.firmCategory.toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bVal = b.firmCategory.toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'breach':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aVal = a.breachType.toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bVal = b.breachType.toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (sortDirection === 'asc') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return aVal > bVal ? 1 : -1;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return aVal < bVal ? 1 : -1;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Paginate
Â  Â  Â  Â  Â  Â  const startIndex = (currentPage - 1) * rowsPerPage;
Â  Â  Â  Â  Â  Â  const endIndex = startIndex + rowsPerPage;
Â  Â  Â  Â  Â  Â  const pageData = sortedData.slice(startIndex, endIndex);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Render rows
Â  Â  Â  Â  Â  Â  pageData.forEach(row => {
Â  Â  Â  Â  Â  Â  Â  Â  const tr = document.createElement('tr');
Â  Â  Â  Â  Â  Â  Â  Â  tr.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${formatDate(row.date)}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>${row.firm}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>Â£${formatNumber(row.amount)}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><span class="badge badge-category" style="background-color: ${getCategoryColour(row.firmCategory)}20; color: ${getCategoryColour(row.firmCategory)}">${row.firmCategory}</span></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><span class="badge badge-breach">${row.breachType}</span></td>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  tbody.appendChild(tr);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Update pagination
Â  Â  Â  Â  Â  Â  updatePagination(sortedData.length);
Â  Â  Â  Â  }

Â  Â  Â  Â  // Update pagination
Â  Â  Â  Â  function updatePagination(totalRows) {
Â  Â  Â  Â  Â  Â  const totalPages = Math.ceil(totalRows / rowsPerPage);
Â  Â  Â  Â  Â  Â  const pagination = document.getElementById('pagination');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  pagination.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>Previous</button>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="page-info">Page ${currentPage} of ${totalPages}</span>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Next</button>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Sort table
Â  Â  Â  Â  function sortTable(field) {
Â  Â  Â  Â  Â  Â  if (sortField === field) {
Â  Â  Â  Â  Â  Â  Â  Â  sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  sortField = field;
Â  Â  Â  Â  Â  Â  Â  Â  sortDirection = 'desc';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  updateTable();
Â  Â  Â  Â  }

Â  Â  Â  Â  // Change page
Â  Â  Â  Â  function changePage(page) {
Â  Â  Â  Â  Â  Â  const totalPages = Math.ceil(filteredData.length / rowsPerPage);
Â  Â  Â  Â  Â  Â  if (page >= 1 && page <= totalPages) {
Â  Â  Â  Â  Â  Â  Â  Â  currentPage = page;
Â  Â  Â  Â  Â  Â  Â  Â  updateTable();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Export data
Â  Â  Â  Â  function exportData() {
Â  Â  Â  Â  Â  Â  let csv = 'Date,Firm/Individual,Amount,Category,Breach Type,Summary\n';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  filteredData.forEach(row => {
Â  Â  Â  Â  Â  Â  Â  Â  csv += `"${formatDate(row.date)}","${row.firm}","Â£${formatNumber(row.amount)}",`;
Â  Â  Â  Â  Â  Â  Â  Â  csv += `"${row.firmCategory}","${row.breachType}","${row.summary.replace(/"/g, '""')}"\n`;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const blob = new Blob([csv], { type: 'text/csv' });
Â  Â  Â  Â  Â  Â  const url = window.URL.createObjectURL(blob);
Â  Â  Â  Â  Â  Â  const a = document.createElement('a');
Â  Â  Â  Â  Â  Â  a.href = url;
Â  Â  Â  Â  Â  Â  a.download = `fca_fines_export_${new Date().toISOString().split('T')[0]}.csv`;
Â  Â  Â  Â  Â  Â  a.click();
Â  Â  Â  Â  Â  Â  window.URL.revokeObjectURL(url);
Â  Â  Â  Â  }

Â  Â  Â  Â  // Utility functions
Â  Â  Â  Â  function formatAmount(amount) {
Â  Â  Â  Â  Â  Â  if (amount >= 1000000000) {
Â  Â  Â  Â  Â  Â  Â  Â  return 'Â£' + (amount / 1000000000).toFixed(2) + 'B';
Â  Â  Â  Â  Â  Â  } else if (amount >= 1000000) {
Â  Â  Â  Â  Â  Â  Â  Â  return 'Â£' + (amount / 1000000).toFixed(2) + 'M';
Â  Â  Â  Â  Â  Â  } else if (amount >= 1000) {
Â  Â  Â  Â  Â  Â  Â  Â  return 'Â£' + (amount / 1000).toFixed(0) + 'K';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return 'Â£' + amount.toFixed(0);
Â  Â  Â  Â  }

Â  Â  Â  Â  function formatNumber(num) {
Â  Â  Â  Â  Â  Â  return num.toLocaleString('en-GB');
Â  Â  Â  Â  }

Â  Â  Â  Â  function formatDate(date) {
Â  Â  Â  Â  Â  Â  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
Â  Â  Â  Â  Â  Â  return months[date.getMonth()] + ' ' + date.getFullYear();
Â  Â  Â  Â  }

Â  Â  Â  Â  function truncateLabel(label, maxLength) {
Â  Â  Â  Â  Â  Â  return label.length > maxLength ? label.substring(0, maxLength) + '...' : label;
Â  Â  Â  Â  }

Â  Â  Â  Â  function getCategoryColour(category) {
Â  Â  Â  Â  Â  Â  const colours = {
Â  Â  Â  Â  Â  Â  Â  Â  'Banking': '#003e5a',
Â  Â  Â  Â  Â  Â  Â  Â  'Individual': '#007ea7',
Â  Â  Â  Â  Â  Â  Â  Â  'Corporate': '#00a8e8',
Â  Â  Â  Â  Â  Â  Â  Â  'Asset Management': '#2ecc71',
Â  Â  Â  Â  Â  Â  Â  Â  'Trading Firm': '#f39c12',
Â  Â  Â  Â  Â  Â  Â  Â  'Insurance': '#e74c3c',
Â  Â  Â  Â  Â  Â  Â  Â  'Financial Planning': '#9b59b6'
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  return colours[category] || '#95a5a6';
Â  Â  Â  Â  }

Â  Â  Â  Â  function getBreachTypeColor(breachType) {
Â  Â  Â  Â  Â  Â  const colors = [
Â  Â  Â  Â  Â  Â  Â  Â  '#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6',
Â  Â  Â  Â  Â  Â  Â  Â  '#1abc9c', '#e67e22', '#16a085', '#d35400', '#2980b9'
Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let hash = 0;
Â  Â  Â  Â  Â  Â  for (let i = 0; i < breachType.length; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  hash = ((hash << 5) - hash) + breachType.charCodeAt(i);
Â  Â  Â  Â  Â  Â  Â  Â  hash = hash & hash;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  return colors[Math.abs(hash) % colors.length];
Â  Â  Â  Â  }

Â  Â  Â  Â  function debounce(func, wait) {
Â  Â  Â  Â  Â  Â  let timeout;
Â  Â  Â  Â  Â  Â  return function executedFunction(...args) {
Â  Â  Â  Â  Â  Â  Â  Â  const later = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clearTimeout(timeout);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  func(...args);
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  clearTimeout(timeout);
Â  Â  Â  Â  Â  Â  Â  Â  timeout = setTimeout(later, wait);
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }
Â  Â  </script>
</body>
</html>
